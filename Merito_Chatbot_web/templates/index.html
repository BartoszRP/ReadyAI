<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>{{ title or "ChatBot" }}</title>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: 30px auto; }
        #log { border: 1px solid #aaa; padding: 15px; min-height: 200px; margin-bottom: 20px; }
        input { width: 80%; padding: 8px; }
        button { padding: 8px 15px; }
    </style>
</head>
<body>
    <h1>{{ title or "Chat z Flask + GPT" }}</h1>
    <p>Witaj {{ name or "Bartek" }}</p>

    <div id="log">Historia czatu pojawi się tutaj...</div>

    <input id="msg" placeholder="Napisz wiadomość...">
    <button onclick="send()">Wyślij</button>

    <script>
        let previous_id = null;

        async function send() {
            const message = document.getElementById("msg").value;
            if (!message) return;

            const res = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    message: message,
                    previous_response_id: previous_id
                })
            });

            const data = await res.json();
            previous_id = data.response_id;

            const log = document.getElementById("log");
            log.innerHTML += "<b>Ty:</b> " + message + "<br>";
            log.innerHTML += "<b>Bot:</b> " + data.response + "<br><br>";

            document.getElementById("msg").value = "";
        }
    </script>
</body>
</html>
